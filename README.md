# Learning Management System (LMS)

動画ベースの学習管理システムです。**業種別アクセス制御**機能を搭載し、各業種に特化したトレーニングコンテンツを提供できます。

## 機能

### ユーザー機能
- ✅ ログイン/ログアウト認証
- 📹 動画コンテンツの視聴
- 📊 視聴進捗の自動保存（5秒ごと）
- ▶️ 前回の続きから再生
- 🎯 視聴完了ステータス表示
- 📂 カテゴリー別コンテンツ閲覧
- 🏢 **業種別コンテンツアクセス**

### 管理者機能
- 📤 動画のアップロード（MP4, AVI, MOV, MKV, WebM対応）
- ✏️ 動画情報の編集
- 🗑️ 動画の削除
- 📁 カテゴリー管理（階層構造対応）
- 🏭 **業種管理**（追加・編集・削除）
- 🔐 **カテゴリーアクセス制御**（業種別に公開設定）
- 👥 ユーザー管理（業種・会社名設定）
- 📈 ユーザーごとの視聴統計

## 業種別アクセス制御

このLMSの特徴は、**業種別にコンテンツへのアクセスを制御**できることです。

### 対応業種（デフォルト）
| 業種 | 英語名 | アイコン |
|-----|-------|---------|
| 宿泊 | Accommodation | 🏨 |
| 小売 | Retail | 🏪 |
| 飲食 | Food and Beverage | 🍽️ |
| 介護 | Nursing Care | 💗 |
| 医療 | Medical Care | 🏥 |
| 教育 | Education | 🎓 |

### アクセス制御の仕組み
- **全業種公開**: アクセス制限なし（全ユーザーが閲覧可能）
- **業種限定**: 指定した業種のユーザーのみ閲覧可能
- **管理者**: すべてのカテゴリーにアクセス可能

## 技術スタック

- **Backend**: Flask (Python)
- **Frontend**: HTML/CSS/JavaScript + Bootstrap 5
- **Database**: SQLite
- **Video Player**: Video.js
- **Authentication**: Flask Sessions + Werkzeug Security

## セットアップ方法

### 1. 必要なパッケージをインストール

```bash
pip install -r requirements.txt
```

### 2. データベースを初期化

```bash
python init_db.py
```

これにより以下が作成されます：
- データベースファイル (`lms.db`)
- ビデオ保存フォルダ (`videos/`)
- 業種マスタデータ
- サンプルユーザーアカウント
- サンプルカテゴリー（業種別アクセス制御付き）

### 3. アプリケーションを起動

```bash
python app.py
```

ブラウザで http://localhost:5000 にアクセスします。

## デフォルトアカウント

初期化後、以下のアカウントが利用可能です：

### 管理者アカウント
- **ユーザー名**: `admin`
- **パスワード**: `admin123`
- **権限**: 全カテゴリーアクセス、管理画面へのアクセス、動画管理、ユーザー統計閲覧

### 業種別ユーザーアカウント（パスワードは全て `user123`）

| 業種 | ユーザー名 | 会社名 |
|-----|-----------|-------|
| 宿泊 | `hotel_tanaka` | グランドホテル東京 |
| 宿泊 | `ryokan_suzuki` | 湯元旅館 |
| 小売 | `retail_yamada` | スーパーマート |
| 小売 | `shop_sato` | ファッションストア |
| 飲食 | `restaurant_ito` | さくらレストラン |
| 介護 | `care_watanabe` | スマイルケアセンター |
| 医療 | `medical_takahashi` | セントラルクリニック |
| 教育 | `edu_kobayashi` | ブライトアカデミー |

## カテゴリー構造とアクセス権

```
├── 基礎編              [全業種公開]
│   ├── プロンプト入門
│   └── 基本操作ガイド
├── 応用編              [全業種公開]
│   ├── 業務活用術
│   └── データ分析活用
├── 実践編              [全業種公開]
│   ├── 事例紹介
│   └── ワークショップ
├── 宿泊業向けAI活用    [宿泊業のみ]
│   ├── 予約管理の効率化
│   └── 多言語対応
├── 小売業向けAI活用    [小売業のみ]
│   └── 在庫管理の最適化
├── 飲食業向けAI活用    [飲食業のみ]
│   └── メニュー開発支援
├── 介護業向けAI活用    [介護業のみ]
│   └── ケアプラン作成支援
├── 医療業向けAI活用    [医療業のみ]
│   └── 医療文書作成支援
└── 教育業向けAI活用    [教育業のみ]
    └── 教材作成支援
```

## ディレクトリ構造

```
50Development/LMS/
├── app.py                          # メインアプリケーション
├── init_db.py                      # データベース初期化スクリプト
├── test_app.py                     # テストスイート
├── requirements.txt                # 依存パッケージ
├── README.md                       # このファイル
├── QUICKSTART.md                   # クイックスタートガイド
├── DEPLOYMENT.md                   # デプロイガイド
├── lms.db                          # SQLiteデータベース（自動生成）
├── videos/                         # 動画ファイル保存先（自動生成）
│   └── *.mp4
└── templates/                      # HTMLテンプレート
    ├── login.html                  # ログインページ
    ├── course_catalog.html         # コースカタログ（カテゴリー一覧）
    ├── category_detail.html        # カテゴリー詳細ページ
    ├── dashboard.html              # ユーザーダッシュボード
    ├── watch.html                  # 動画視聴ページ
    └── admin.html                  # 管理者ダッシュボード
```

## データベーススキーマ

### industries テーブル（業種マスタ）
- `id`: 業種ID（主キー）
- `name`: 業種名（日本語）
- `name_en`: 業種名（英語）
- `description`: 説明
- `icon`: アイコンクラス
- `color`: カラーコード
- `created_at`: 作成日時

### users テーブル
- `id`: ユーザーID（主キー）
- `username`: ユーザー名（ユニーク）
- `email`: メールアドレス（ユニーク）
- `password_hash`: ハッシュ化されたパスワード
- `industry_id`: 所属業種ID（外部キー）
- `company_name`: 会社名
- `is_admin`: 管理者フラグ（0 or 1）
- `created_at`: 登録日時

### categories テーブル
- `id`: カテゴリーID（主キー）
- `name`: カテゴリー名
- `description`: 説明
- `icon`: アイコンクラス
- `color`: カラーコード
- `parent_id`: 親カテゴリーID（外部キー、階層構造用）
- `display_order`: 表示順
- `created_at`: 作成日時

### category_industry_access テーブル（アクセス制御）
- `id`: ID（主キー）
- `category_id`: カテゴリーID（外部キー）
- `industry_id`: 業種ID（外部キー）
- `created_at`: 作成日時

> ※レコードがないカテゴリーは「全業種公開」

### videos テーブル
- `id`: 動画ID（主キー）
- `title`: 動画タイトル
- `description`: 説明
- `filename`: ファイル名
- `category_id`: カテゴリーID（外部キー）
- `uploaded_by`: アップロードしたユーザーID
- `created_at`: アップロード日時

### progress テーブル
- `id`: 進捗ID（主キー）
- `user_id`: ユーザーID（外部キー）
- `video_id`: 動画ID（外部キー）
- `progress_percent`: 視聴進捗率（0-100）
- `last_position`: 最後の再生位置（秒）
- `updated_at`: 更新日時

## テストの実行

```bash
# pytestをインストール
pip install pytest

# テストを実行
python -m pytest test_app.py -v
```

全29テストが含まれています：
- ログイン機能テスト
- 業種別アクセス制御テスト
- 管理画面アクセステスト
- 業種管理APIテスト
- カテゴリー管理APIテスト
- ユーザー管理APIテスト

## 使い方

### ユーザー向け

1. **ログイン**
   - ユーザー名とパスワードを入力してログイン
   - 業種に応じたコンテンツが表示されます

2. **コースを選択**
   - コースカタログからカテゴリーを選択
   - 自分の業種に対応したカテゴリーのみ表示されます

3. **動画を視聴**
   - カテゴリー内の動画を選択して視聴開始
   - 進捗は自動的に保存されます（5秒ごと）

4. **視聴を再開**
   - 前回視聴した動画は続きから再生されます
   - 進捗バーで視聴状況を確認できます

### 管理者向け

1. **管理画面にアクセス**
   - 管理者アカウントでログイン
   - 自動的に管理画面へ遷移

2. **動画をアップロード**
   - 「新しい動画をアップロード」ボタンをクリック
   - タイトル、説明、カテゴリー、動画ファイルを選択
   - アップロードを実行

3. **カテゴリーを管理**
   - カテゴリーの追加・編集・削除
   - サブカテゴリーの作成
   - アイコンとカラーのカスタマイズ

4. **アクセス制御を設定**
   - カテゴリーの🔐ボタンをクリック
   - アクセスを許可する業種を選択
   - 業種を選択しない場合は「全業種公開」

5. **業種を管理**
   - 新しい業種の追加
   - 業種情報の編集
   - 不要な業種の削除

6. **ユーザーを管理**
   - 新しいユーザーの作成（業種・会社名設定）
   - ユーザー情報の編集
   - 視聴統計の確認

## セキュリティに関する注意

- **本番環境では必ず以下を変更してください**:
  - `app.py` の `app.secret_key` を強力なランダム文字列に変更
  - デフォルトアカウントのパスワードを変更
  - HTTPS を使用する
  - デバッグモード (`debug=True`) を無効にする

## トラブルシューティング

### 動画が再生されない
- ブラウザが動画形式をサポートしているか確認
- MP4形式（H.264コーデック）が最も互換性が高い

### 進捗が保存されない
- ブラウザのコンソールでエラーを確認
- データベースファイルの書き込み権限を確認

### アップロードが失敗する
- ファイルサイズが500MBを超えていないか確認
- `videos/` フォルダの書き込み権限を確認

### カテゴリーが表示されない
- ログインユーザーの業種とカテゴリーのアクセス設定を確認
- 管理画面でアクセス制御設定を確認

## カスタマイズ

### 最大ファイルサイズの変更
`app.py` の以下の行を変更：
```python
app.config['MAX_CONTENT_LENGTH'] = 500 * 1024 * 1024  # 500MB
```

### 進捗保存の間隔変更
`templates/watch.html` の以下の行を変更：
```javascript
progressSaveInterval = setInterval(saveProgress, 5000);  // 5000ms = 5秒
```

## ライセンス

このプロジェクトは社内利用を想定しています。

## サポート

問題が発生した場合は、開発チームまでお問い合わせください。
