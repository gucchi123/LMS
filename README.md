# Learning Management System (LMS)

動画ベースの学習管理システムです。ユーザーは動画コンテンツを視聴し、進捗を自動的に記録できます。管理者は動画のアップロード、編集、削除が可能です。

## 機能

### ユーザー機能
- ✅ ログイン/ログアウト認証
- 📹 動画コンテンツの視聴
- 📊 視聴進捗の自動保存（5秒ごと）
- ▶️ 前回の続きから再生
- 🎯 視聴完了ステータス表示

### 管理者機能
- 📤 動画のアップロード（MP4, AVI, MOV, MKV, WebM対応）
- ✏️ 動画情報の編集
- 🗑️ 動画の削除
- 👥 ユーザー管理
- 📈 ユーザーごとの視聴統計

## 技術スタック

- **Backend**: Flask (Python)
- **Frontend**: HTML/CSS/JavaScript + Bootstrap 5
- **Database**: SQLite
- **Video Player**: Video.js
- **Authentication**: Flask Sessions + Werkzeug Security

## セットアップ方法

### 1. 必要なパッケージをインストール

```bash
pip install -r requirements.txt
```

### 2. データベースを初期化

```bash
python init_db.py
```

これにより以下が作成されます：
- データベースファイル (`lms.db`)
- ビデオ保存フォルダ (`videos/`)
- デフォルトユーザーアカウント

### 3. アプリケーションを起動

```bash
python app.py
```

ブラウザで http://localhost:5000 にアクセスします。

## デフォルトアカウント

初期化後、以下のアカウントが利用可能です：

### 管理者アカウント
- **ユーザー名**: `admin`
- **パスワード**: `admin123`
- **権限**: 管理画面へのアクセス、動画管理、ユーザー統計閲覧

### 一般ユーザーアカウント
- **ユーザー名**: `user1`
- **パスワード**: `user123`
- **権限**: 動画視聴のみ

- **ユーザー名**: `user2`
- **パスワード**: `user123`
- **権限**: 動画視聴のみ

## ディレクトリ構造

```
50Development/LMS/
├── app.py                          # メインアプリケーション
├── init_db.py                      # データベース初期化スクリプト
├── requirements.txt                # 依存パッケージ
├── README.md                       # このファイル
├── lms.db                          # SQLiteデータベース（自動生成）
├── videos/                         # 動画ファイル保存先（自動生成）
│   └── *.mp4
└── templates/                      # HTMLテンプレート
    ├── login.html                  # ログインページ
    ├── dashboard.html              # ユーザーダッシュボード
    ├── watch.html                  # 動画視聴ページ
    └── admin.html                  # 管理者ダッシュボード
```

## データベーススキーマ

### users テーブル
- `id`: ユーザーID（主キー）
- `username`: ユーザー名（ユニーク）
- `email`: メールアドレス（ユニーク）
- `password_hash`: ハッシュ化されたパスワード
- `is_admin`: 管理者フラグ（0 or 1）
- `created_at`: 登録日時

### videos テーブル
- `id`: 動画ID（主キー）
- `title`: 動画タイトル
- `description`: 説明
- `filename`: ファイル名
- `uploaded_by`: アップロードしたユーザーID
- `created_at`: アップロード日時

### progress テーブル
- `id`: 進捗ID（主キー）
- `user_id`: ユーザーID（外部キー）
- `video_id`: 動画ID（外部キー）
- `progress_percent`: 視聴進捗率（0-100）
- `last_position`: 最後の再生位置（秒）
- `updated_at`: 更新日時

## 使い方

### ユーザー向け

1. **ログイン**
   - ユーザー名とパスワードを入力してログイン

2. **動画を視聴**
   - ダッシュボードから視聴したい動画を選択
   - 動画プレイヤーで視聴開始
   - 進捗は自動的に保存されます（5秒ごと）

3. **視聴を再開**
   - 前回視聴した動画は続きから再生されます
   - 進捗バーで視聴状況を確認できます

### 管理者向け

1. **管理画面にアクセス**
   - 管理者アカウントでログイン
   - 右上の「管理画面」ボタンをクリック

2. **動画をアップロード**
   - 「新しい動画をアップロード」ボタンをクリック
   - タイトル、説明、動画ファイルを選択
   - アップロードを実行

3. **動画を編集**
   - 動画一覧から編集ボタン（鉛筆アイコン）をクリック
   - タイトルや説明を変更

4. **動画を削除**
   - 動画一覧から削除ボタン（ゴミ箱アイコン）をクリック
   - 確認後、削除を実行

5. **ユーザー統計を確認**
   - ユーザー一覧から「視聴統計」ボタンをクリック
   - 各ユーザーの視聴進捗を確認

## セキュリティに関する注意

- **本番環境では必ず以下を変更してください**:
  - `app.py` の `app.secret_key` を強力なランダム文字列に変更
  - デフォルトアカウントのパスワードを変更
  - HTTPS を使用する
  - デバッグモード (`debug=True`) を無効にする

## トラブルシューティング

### 動画が再生されない
- ブラウザが動画形式をサポートしているか確認
- MP4形式（H.264コーデック）が最も互換性が高い

### 進捗が保存されない
- ブラウザのコンソールでエラーを確認
- データベースファイルの書き込み権限を確認

### アップロードが失敗する
- ファイルサイズが500MBを超えていないか確認
- `videos/` フォルダの書き込み権限を確認

## カスタマイズ

### 最大ファイルサイズの変更
`app.py` の以下の行を変更：
```python
app.config['MAX_CONTENT_LENGTH'] = 500 * 1024 * 1024  # 500MB
```

### 進捗保存の間隔変更
`templates/watch.html` の以下の行を変更：
```javascript
progressSaveInterval = setInterval(saveProgress, 5000);  // 5000ms = 5秒
```

## ライセンス

このプロジェクトは社内利用を想定しています。

## サポート

問題が発生した場合は、開発チームまでお問い合わせください。
