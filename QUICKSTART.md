# LMS クイックスタートガイド

## LMSが正常に起動しました！

アプリケーションは以下のURLでアクセスできます：
- **ローカルアクセス**: http://127.0.0.1:5000

## デフォルトアカウント

### 管理者アカウント
- **ユーザー名**: `admin`
- **パスワード**: `admin123`
- **ロール**: `super_admin`
- **権限**: 全テナント・全カテゴリーアクセス、全管理機能

### 業種別ユーザーアカウント（パスワードは全て `user123`）

| 業種 | ユーザー名 | 会社名 | ロール |
|-----|-----------|-------|--------|
| 宿泊 | `hotel_tanaka` | グランドホテル東京 | `company_admin` |
| 宿泊 | `ryokan_suzuki` | 湯元旅館 | `user` |
| 小売 | `retail_yamada` | スーパーマート | `company_admin` |
| 小売 | `shop_sato` | ファッションストア | `user` |
| 飲食 | `restaurant_ito` | さくらレストラン | `user` |
| 介護 | `care_watanabe` | スマイルケアセンター | `user` |
| 医療 | `medical_takahashi` | セントラルクリニック | `user` |
| 教育 | `edu_kobayashi` | ブライトアカデミー | `user` |

> **ポイント**: 業種別ユーザーは、自分の業種に対応したカテゴリーのみ閲覧できます。`company_admin` は自社テナント内のユーザー管理も可能です。

## ロールの違い

| ロール | できること |
|--------|----------|
| `super_admin` | 全テナント管理、全ユーザー管理、全アナリティクス閲覧 |
| `company_admin` | 自テナント内のユーザー管理、自テナントの統計閲覧、管理画面アクセス |
| `user` | コンテンツ閲覧、Q&A投稿・回答、マイ進捗確認、チャット利用 |

## 使い方

### 1. ログイン
1. ブラウザで http://127.0.0.1:5000 を開く
2. アカウント情報を入力してログイン
3. `super_admin` / `company_admin` は管理画面へ、一般ユーザーはコースカタログへ遷移

### 2. コースを閲覧（ユーザー）
1. コースカタログでカテゴリーを選択
2. 自分の業種に対応したカテゴリーのみ表示されます
3. カテゴリー内の動画を選択して視聴

### 3. 動画を視聴（ユーザー）
1. 動画が自動的に再生開始
2. **進捗は5秒ごとに自動保存**されます
3. 次回視聴時は**続きから再生**できます

### 4. Q&Aを利用（ユーザー）
1. 動画視聴ページの「Q&A」タブを選択
2. 質問を投稿（2000文字以内）
3. 他のメンバーの質問に回答も可能
4. 自分の質問は編集・削除が可能
5. マイ進捗ページの「社内Q&A」タブで同じ会社のQ&Aも閲覧可能

### 5. AIチャットを使う（ユーザー）
1. チャットページで業務に関する質問を入力
2. Rakuten AI 3.0が業種に応じた回答を生成
3. 関連する動画コンテンツも推薦されます

### 6. マイ進捗を確認（ユーザー）
1. マイ進捗ページで全体の視聴率を確認
2. カテゴリー別・動画別の進捗を確認
3. 社内Q&Aタブで同僚の質問と回答を閲覧

### 7. 動画を管理（管理者）
1. 「新しい動画をアップロード」ボタンで動画追加
2. 鉛筆アイコンで動画情報を編集
3. ゴミ箱アイコンで動画を削除
4. 🎤アイコンでAI文字起こしを実行

### 8. カテゴリーを管理（管理者）
1. 「新しいカテゴリーを追加」で作成
2. 🔐ボタンでアクセス制御を設定
3. 業種を選択して保存

### 9. 業種を管理（管理者）
1. 「新しい業種を追加」で業種を作成
2. 鉛筆アイコンで編集
3. ゴミ箱アイコンで削除

### 10. ユーザーを管理（管理者）
1. 「新しいユーザーを追加」でユーザー作成
2. テナント・部署・業種・ロールを設定
3. CSV一括インポート/エクスポートも利用可能

### 11. アナリティクスを確認（管理者）
1. 動画アナリティクス: 動画ごとの視聴統計
2. ユーザー進捗: テナント別・部署別の進捗状況
3. Q&A分析: 質問数・回答率・未回答質問一覧

### 12. お知らせを管理（管理者）
1. 全体通知またはテナント限定の通知を作成
2. 種別（info / warning / important）を選択
3. 有効期限を設定可能

## 実装済み機能

- [x] ユーザー認証（ログイン/ログアウト）
- [x] ロールベースアクセス制御（super_admin / company_admin / user）
- [x] マルチテナント対応
- [x] 動画アップロード（MP4, AVI, MOV, MKV, WebM対応）
- [x] 動画視聴（Video.jsプレイヤー）
- [x] 視聴進捗の自動保存
- [x] 前回の続きから再生
- [x] 動画の編集・削除
- [x] カテゴリー管理（階層構造対応）
- [x] **業種管理**（追加・編集・削除）
- [x] **業種別アクセス制御**
- [x] **テナント（企業）管理**
- [x] **部署管理**（階層構造対応）
- [x] ユーザー管理（テナント・部署・ロール設定）
- [x] CSV一括インポート/エクスポート
- [x] AI文字起こし（Whisper）
- [x] AIチャットアシスタント（Rakuten AI 3.0 + RAG）
- [x] Q&A機能（質問・回答・編集・削除）
- [x] 社内Q&A（同テナントのQ&A閲覧）
- [x] マイ進捗ダッシュボード
- [x] 動画アナリティクス
- [x] ユーザー進捗管理
- [x] Q&A分析ダッシュボード
- [x] お知らせ・通知機能
- [x] GA4トラッキング
- [x] 進捗バーとステータス表示
- [x] レスポンシブデザイン（モバイル対応）
- [x] データベース自動マイグレーション

## 業種別アクセス制御

### カテゴリー構造
```
├── 基礎編              [全業種公開]
├── 応用編              [全業種公開]
├── 実践編              [全業種公開]
├── 宿泊業向けAI活用    [宿泊業のみ]
├── 小売業向けAI活用    [小売業のみ]
├── 飲食業向けAI活用    [飲食業のみ]
├── 介護業向けAI活用    [介護業のみ]
├── 医療業向けAI活用    [医療業のみ]
└── 教育業向けAI活用    [教育業のみ]
```

### 試してみよう！
1. `hotel_tanaka` でログイン → 宿泊業カテゴリーが見える（company_admin権限あり）
2. `retail_yamada` でログイン → 小売業カテゴリーが見える（company_admin権限あり）
3. `admin` でログイン → すべてのカテゴリーが見える（super_admin）

## サーバーの操作

### サーバーを停止
ターミナルで `Ctrl + C` を押す

### サーバーを再起動
```bash
cd "50Development/LMS"
python app.py
```

### データベースをリセット
```bash
python init_db.py
```
**注意**: これにより全てのユーザーデータと進捗がリセットされます

### テストを実行
```bash
python -m pytest test_app.py -v
```
全198テストが実行されます。

## ファイル構造

```
50Development/LMS/
├── app.py                  # メインアプリケーション
├── init_db.py              # データベース初期化
├── migrate_db.py           # 差分マイグレーション
├── test_app.py             # テストスイート（198テスト）
├── requirements.txt        # 依存パッケージ
├── lms.db                  # SQLiteデータベース
├── videos/                 # アップロードされた動画
├── db_backups/             # DBバックアップ（自動）
├── templates/              # HTMLテンプレート（14ファイル）
│   ├── login.html          # ログインページ
│   ├── course_catalog.html # コースカタログ
│   ├── category_detail.html # カテゴリー詳細
│   ├── dashboard.html      # ダッシュボード
│   ├── watch.html          # 動画視聴（Q&A含む）
│   ├── admin.html          # 管理画面
│   ├── chat.html           # AIチャット
│   ├── chat_widget.html    # チャットウィジェット
│   ├── my_progress.html    # マイ進捗（社内Q&A含む）
│   ├── analytics.html      # アクセスアナリティクス
│   ├── video_analytics.html # 動画アナリティクス
│   ├── user_progress.html  # ユーザー進捗管理
│   ├── qa_analytics.html   # Q&A分析
│   └── ga4_tracking.html   # GA4トラッキング
├── README.md               # 詳細ドキュメント
├── QUICKSTART.md           # このファイル
└── DEPLOYMENT.md           # デプロイガイド
```

## セキュリティに関する注意

**本番環境で使用する場合は必ず以下を実施してください**:

1. **Secret Keyの変更**
   環境変数 `SECRET_KEY` を強力なランダム文字列に設定：
   ```python
   import secrets
   print(secrets.token_hex(32))
   ```

2. **デフォルトパスワードの変更**
   管理者アカウントと全ユーザーアカウントのパスワードを変更

3. **Debug モードの無効化**
   環境変数 `FLASK_ENV=production` を設定

4. **HTTPS の使用**
   本番環境では必ずHTTPSを使用してください

## トラブルシューティング

### サーバーが起動しない
- Pythonがインストールされているか確認
- 必要なパッケージがインストールされているか確認: `pip install -r requirements.txt`
- ポート5000が既に使用されていないか確認

### 動画が再生されない
- ブラウザが動画形式をサポートしているか確認
- MP4形式（H.264コーデック）が最も互換性が高い
- ブラウザのコンソールでエラーを確認（F12キー）

### カテゴリーが表示されない
- ログインユーザーの業種を確認
- 管理画面でカテゴリーのアクセス制御設定を確認

### 進捗が保存されない
- ブラウザのJavaScriptが有効になっているか確認
- ブラウザのコンソールでエラーを確認
- データベースファイル `lms.db` の書き込み権限を確認

### アップロードが失敗する
- ファイルサイズが500MBを超えていないか確認
- ファイル形式が対応しているか確認（MP4, AVI, MOV, MKV, WebM）
- `videos/` フォルダの書き込み権限を確認

## サポート

問題が発生した場合や機能追加のリクエストがある場合は、開発チームまでご連絡ください。
